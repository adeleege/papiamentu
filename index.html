<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Woorden oefenen</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <style>
    :root{
      --bg:#fafafa;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#2563eb;
      --accent-soft:#eff6ff;
      --ok:#16a34a;
      --bad:#dc2626;
      --radius:14px;
      --shadow:0 1px 2px rgba(0,0,0,.05);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{max-width:820px;margin:0 auto;padding:16px}

    .tabs{
      display:flex;
      gap:8px;
      margin:10px 0 14px;
      flex-wrap:wrap;
    }

    .tab{
      padding:10px 14px;
      border:1px solid var(--border);
      border-radius:999px;
      background:#fff;
      cursor:pointer;
      font-weight:600;
    }

    .tab.active{
      background:var(--accent-soft);
      border-color:rgba(37,99,235,.4);
    }

    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:14px;
      margin:12px 0;
      box-shadow:var(--shadow);
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .muted{color:var(--muted);font-size:12px}
    .small{font-size:13px}

    button{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-weight:600;
      cursor:pointer;
    }

    button.primary{
      background:var(--accent-soft);
      border-color:rgba(37,99,235,.4);
    }

    button:disabled{opacity:.5}

    input{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
    }

    .list{
      max-height:62vh;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:8px;
      background:#fff;
    }

    .item{padding:10px}
    .item + .item{border-top:1px solid #f3f4f6}

    .ok{border-color:rgba(22,163,74,.5);background:rgba(22,163,74,.08)}
    .bad{border-color:rgba(220,38,38,.5);background:rgba(220,38,38,.08)}

    .pill{
      padding:4px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      font-size:12px;
      background:#fff;
    }

    .chip{
      display:flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      cursor:pointer;
    }

    #splash{
      position:fixed;
      inset:0;
      background:#f9fafb;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    .splash-card{text-align:center}
    .splash-title{font-size:28px;font-weight:700}
    .splash-sub{color:#6b7280;margin-top:4px}
    .loader{
      width:36px;height:36px;
      border:3px solid #e5e7eb;
      border-top-color:#2563eb;
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin:16px auto 0;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>

<div id="splash">
  <div class="splash-card">
    <div class="splash-title">Papiamentu</div>
    <div class="splash-sub">Woorden oefenen</div>
    <div class="loader"></div>
  </div>
</div>

<div class="wrap">

  <div class="tabs">
    <div id="tabOverview" class="tab active">Woordenlijst</div>
    <div id="tabLearn" class="tab">Oefenen</div>
    <div id="tabQuiz" class="tab">Test jezelf</div>
  </div>

  <!-- OVERVIEW -->
  <div id="overviewShell">
    <div class="card">
      <div class="row">
        <strong>Filters</strong>
        <button id="selAllBtn">Alles</button>
        <button id="selNoneBtn">Niets</button>
      </div>

      <div id="posChecks" class="row" style="margin-top:10px"></div>

      <div class="row" style="margin-top:12px">
        <strong>Les</strong>
        <input id="lessonMax" type="number" min="1" style="width:80px">
        <span class="muted">t/m</span>
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <strong>Woorden</strong>
        <button id="sortAZBtn">Sorteren A–Z</button>
      </div>
      <div id="pairs" class="list" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- LEARN -->
  <div id="learnShell" style="display:none">
    <div class="card" id="learnCard" style="display:none">
      <div class="muted" id="learnMeta"></div>
      <h3 id="learnFront"></h3>
      <div id="learnBack" style="display:none;margin-top:10px"></div>

      <div style="margin-top:12px">
        <button id="learnRevealBtn" class="primary">Toon antwoord</button>
        <button id="learnNextBtn">Volgende</button>
      </div>

      <div id="learnGradeBtns" style="display:none;margin-top:10px">
        <button data-q="0">Again</button>
        <button data-q="3">Hard</button>
        <button data-q="4">Good</button>
        <button data-q="5">Easy</button>
      </div>
    </div>

    <div class="card" id="learnEmpty" style="display:none">
      Geen woorden in deze selectie.
    </div>
  </div>

  <!-- QUIZ -->
  <div id="quizShell" style="display:none">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <strong>Quiz</strong>
        <div>
          <span class="pill"><span id="quizCorrect">0</span>/<span id="quizTotal">0</span></span>
          <span class="pill"><span id="quizPct">0%</span></span>
        </div>
      </div>

      <button id="quizResetBtn" style="margin-top:10px">Reset score</button>
    </div>

    <div class="card" id="quizCard" style="display:none">
      <div class="muted" id="quizMeta"></div>
      <h3 id="quizQuestion"></h3>
      <div id="quizOptions" style="margin-top:10px"></div>

      <div id="quizFeedback" style="margin-top:10px"></div>

      <button id="quizNextBtn" style="display:none;margin-top:10px">Volgende</button>
    </div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxlXU7l80EPIpJJwRam1s9CdbH8PQ_PvQyftwTq55Qk51qkorrnBjwKXu2dxAp-Np_4/exec";
const LS_KEY = "papiamentu_app_v1";

let rawCards=[], cards=[], learnCurrent=null, quizCurrent=null, quizLocked=false;
let state = JSON.parse(localStorage.getItem(LS_KEY) || "{}");

const POS_LABELS = {
  noun:"Zelfst. nw", verb:"Werkwoord", adj:"Bijv. nw",
  adv:"Bijwoord", prep:"Voorzetsel", pron:"Voornaamw.",
  conj:"Voegwoord", phrase:"Uitdrukking", other:"Overig"
};

const el = id => document.getElementById(id);
const norm = s => String(s||"").toLowerCase();

function save(){localStorage.setItem(LS_KEY,JSON.stringify(state))}

function activateTab(name){
  ["overview","learn","quiz"].forEach(t=>{
    el("tab"+t.charAt(0).toUpperCase()+t.slice(1)).classList.toggle("active",t===name);
    el(t+"Shell").style.display = t===name?"block":"none";
  });
  if(name==="learn") nextLearn();
  if(name==="quiz") nextQuiz();
}

function load(){
  fetch(API_URL).then(r=>r.json()).then(j=>{
    rawCards=j.data||[];
    cards=rawCards.filter(c=>String(c.active).toUpperCase()!=="FALSE");
    document.getElementById("splash").style.display="none";
    render();
  });
}

function render(){
  renderFilters();
  renderPairs();
}

function renderFilters(){
  const cont=el("posChecks");
  cont.innerHTML="";
  const types=[...new Set(cards.map(c=>norm(c.pos)))];
  types.forEach(p=>{
    const lab=document.createElement("label");
    lab.className="chip";
    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=!state.pos||state.pos.includes(p);
    cb.onchange=()=>{
      state.pos=state.pos||[];
      cb.checked?state.pos.push(p):state.pos=state.pos.filter(x=>x!==p);
      save();renderPairs();
    };
    lab.append(cb,document.createTextNode(" "+(POS_LABELS[p]||p)));
    cont.appendChild(lab);
  });
}

function filtered(){
  return cards.filter(c=>{
    if(state.pos && !state.pos.includes(norm(c.pos))) return false;
    if(state.lesson && Number(c.due)>state.lesson) return false;
    return true;
  });
}

function renderPairs(){
  const box=el("pairs");
  box.innerHTML="";
  let arr=filtered();
  if(state.sortAZ) arr.sort((a,b)=>a.front.localeCompare(b.front));
  arr.slice(0,200).forEach(c=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`<div class="muted">${c.pos} • les ${c.due}</div><b>${c.front}</b> ↔ ${c.back}`;
    box.appendChild(d);
  });
}

function nextLearn(){
  const pool=filtered();
  if(!pool.length) return;
  const c=pool[Math.floor(Math.random()*pool.length)];
  learnCurrent=c;
  el("learnFront").textContent=c.front;
  el("learnBack").textContent=c.back;
  el("learnBack").style.display="none";
  el("learnCard").style.display="block";
}

function nextQuiz(){
  const pool=filtered();
  if(pool.length<2) return;
  quizCurrent=pool[Math.floor(Math.random()*pool.length)];
  el("quizQuestion").textContent=quizCurrent.front;
}

document.getElementById("sortAZBtn").onclick=()=>{
  state.sortAZ=!state.sortAZ;
  save();renderPairs();
};

document.getElementById("tabOverview").onclick=()=>activateTab("overview");
document.getElementById("tabLearn").onclick=()=>activateTab("learn");
document.getElementById("tabQuiz").onclick=()=>activateTab("quiz");

document.getElementById("lessonMax").onchange=e=>{
  state.lesson=Number(e.target.value);
  save();renderPairs();
};

document.getElementById("selAllBtn").onclick=()=>{state.pos=null;save();render();}
document.getElementById("selNoneBtn").onclick=()=>{state.pos=[];save();render();}

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

load();
</script>
</body>
</html>



